<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Malaysia Air Pollution Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="page-header">
    <h1>Malaysia Air Pollution</h1>
  </header>

  <main class="dashboard">
    <!-- Chart1: Whole Malaysia Map -->
    <section class="chart-section horizontal">
      <div id="MalaysiaMap" class="chart large"></div>
      <div class="chart-text right">
        <p>
          This national map illustrates the average Air Pollution Index (API) across all Malaysian states.
          Darker colours represent higher API levels, revealing that industrialised and densely populated
          states such as Selangor and Sarawak tend to experience poorer air quality compared to rural areas.
        </p>
      </div>
    </section>

    <!-- Chart2 & 3: Subarea map -->
    <section class="chart-section vertical">
      <div class="chart-pair">
        <div id="PeninsularMap" class="chart large"></div>
        <div id="Sabah_Sarawak" class="chart medium"></div>
      </div>
      <p class="chart-text centered">
        The regional view compares API levels between Peninsular Malaysia and East Malaysia.
        In Peninsular Malaysia, industrial zones such as Perak and Shah Alam exhibit higher pollution,
        while Sibu and Kudat in East Malaysia show very unhealthy levels mainly due to urban emissions
        and transboundary haze from neighbouring regions.
      </p>
    </section>

    <!-- Pollutant Comparison -->
    <section class="chart-section horizontal">
      <div class="chart-container">
        <div id="lollipopChart" class="chart"></div>
      </div>

      <div class="chart-text right">
        This chart compares the Air Pollution Index levels of major pollutants across different states and months.
        Users can quickly spot when and where pollution peaks, and which pollutants contribute most to poor air quality.
        The color and trend patterns help highlight seasonal haze periods and regional differences,
        making the data easy to interpret at a glance.
      </div>
    </section>


    <!-- Monthly trend-->
    <section class="chart-section horizontal-left">
      <p class="chart-text left">
        The chart shows monthly API trends across Malaysian states in 2024, with higher pollution during dry months and
        cleaner air during monsoon periods. <strong>Weather </strong>and <strong>seasonal patterns</strong> strongly
        influence air quality nationwide.
      </p>
      <div class="chart-container">
        <div id="lineChart" class="chart"></div>
      </div>
    </section>


    <!-- Rainfall vs API level-->
    <section class="chart-section horizontal">
      <div class="chart-container">
        <div id="scatterPlot" class="chart"></div>
      </div>
      <p class="chart-text right">
        The chart shows an inverse relationship between rainfall and API across Malaysian states â€” <strong>higher
          rainfall</strong>
        generally
        leads to cleaner air, while dry months see higher pollution levels. States like Kelantan and Pahang experience
        higher
        API during dry periods, whereas wetter states such as Sabah and Sarawak maintain lower pollution throughout the
        year.
      </p>
    </section>

    <!-- Area type vs API level-->
    <section class="chart-section horizontal-left">
      <p class="chart-text left">
        <strong>Urban areas</strong> record higher levels of Particulate Matter and Carbon monoxide from traffic, construction, and
        industry, while rural areas have
        cleaner air overall. However,Ground-level Ozone is higher in rural regions as it forms when urban pollutants
        drift and react with
        sunlight â€” showing that air pollution extends beyond city boundaries.
      </p>
      <div class="chart-container">
        <div id="stackedBar" class="chart"></div>
      </div>
    </section>

    <!-- Metadata footer -->
    <footer class="metadata">
      <p><strong>Data Sources:</strong></p>
      <ul>
        <li><a href="https://data.gov.my/data-catalogue/air_pollution" target="_blank">Malaysia Air Pollution
            (data.gov.my)</a></li>
        <li><a href="https://www.kaggle.com/datasets/ynshung/malaysia-air-pollution-index" target="_blank">Malaysia Air
            Pollution Index (Kaggle)</a></li>
        <li><a
            href="https://archive.data.gov.my/data/dataset/daily-projected-rainfall-ccsm3a1b-by-state-in-peninsular-malaysia/resource/c324c4f1-7d41-4e68-8e94-e0f5ae5f6274?view_id=8618b3f3-11b8-43a6-a246-7af02cbd68af"
            target="_blank">Projected Rainfall by State (Peninsular Malaysia)</a></li>
      </ul>
      <p><strong>Author:</strong> Soh Zhi Tying | <strong>Created:</strong>17/10/2025</p>
    </footer>

  </main>

  <script>
    // ====== Chart 1: Whole Malaysia Map ======
    const MalaysiaMap = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": { "text": "Average Air Pollution Index (API) in Malaysian States" },
      "width": 700,
      "height": 450,
      "layer": [
        {
          "data": { "graticule": true },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 2000,
            "translate": [370, 320]
          },
          "mark": { "type": "geoshape", "stroke": "lightgrey", "strokeWidth": 0.5 }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/nullifye/malaysia.geojson/refs/heads/master/malaysia.state.geojson",
            "format": { "type": "json", "property": "features" }
          },
          "mark": {
            "type": "geoshape",
            "fill": null,
            "stroke": "black",
            "strokeWidth": 2
          },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/nullifye/malaysia.geojson/refs/heads/master/malaysia.state.geojson",
            "format": { "type": "json", "property": "features" }
          },
          "transform": [
            {
              "lookup": "properties.name",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/Average_air_quality.csv"
                },
                "key": "State",
                "fields": ["API_Value"]
              }
            }
          ],
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          },
          "mark": { "type": "geoshape" },
          "encoding": {
            "color": {
              "field": "API_Value",
              "type": "quantitative",
              "title": "Air Pollution Index (API)",
              "scale": { "scheme": "goldgreen" }
            },
            "tooltip": [
              { "field": "properties.name", "title": "State" },
              { "field": "API_Value", "title": "API" }
            ]
          }
        },
        {
          "data": {
            "values": [
              {
                "x1": 102.3,
                "y1": 6.1,
                "x2": 104.3,
                "y2": 6.4
              }
            ]
          },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          },
          "mark": { "type": "rule", "color": "black", "strokeWidth": 1 },
          "encoding": {
            "longitude": { "field": "x1" },
            "latitude": { "field": "y1" },
            "longitude2": { "field": "x2" },
            "latitude2": { "field": "y2" }
          }
        },
        {
          "data": {
            "values": [
              {
                "Longitude": 105.3,
                "Latitude": 6.6,
                "label": "ðŸ“ˆ High API likely due to transboundary haze"
              }
            ]
          },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          },
          "mark": {
            "type": "text",
            "fontSize": 12,
            "fontWeight": "bold",
            "fontStyle": "italic",
            "color": "black",
            "baseline": "middle",
            "dx": 3
          },
          "encoding": {
            "longitude": { "field": "Longitude" },
            "latitude": { "field": "Latitude" },
            "text": { "field": "label" }
          }
        },
        {
          "data": {
            "values": [
              {
                "x1": 116.8,
                "y1": 5.4,
                "x2": 117,
                "y2": 9
              }
            ]
          },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          },
          "mark": { "type": "rule", "color": "black", "strokeWidth": 1 },
          "encoding": {
            "longitude": { "field": "x1" },
            "latitude": { "field": "y1" },
            "longitude2": { "field": "x2" },
            "latitude2": { "field": "y2" }
          }
        },
        {
          "data": {
            "values": [
              {
                "Longitude": 116.5,
                "Latitude": 9.2,
                "label": "ðŸŒ¿ Low API shows cleaner, less urban air"
              }
            ]
          },
          "projection": {
            "type": "mercator",
            "center": [110, 3],
            "scale": 1850,
            "translate": [420, 350]
          },
          "mark": {
            "type": "text",
            "fontSize": 12,
            "fontWeight": "bold",
            "fontStyle": "italic",
            "color": "black",
            "baseline": "middle",
            "dx": 3
          },
          "encoding": {
            "longitude": { "field": "Longitude" },
            "latitude": { "field": "Latitude" },
            "text": { "field": "label" }
          }
        }
      ],
      "config": { "background": "#deebf7" }
    }
      ;

    // ====== Chart 2: Peninsular Malaysia Map ======
    const PeninsularMap = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "API Levels (Peninsular Malaysia)",
      "width": 700,
      "height": 400,
      "projection": {
        "type": "mercator",
        "center": [102.5, 4],
        "scale": 4000,
        "translate": [350, 200]
      },
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/nullifye/malaysia.geojson/refs/heads/master/malaysia.state.geojson",
            "format": { "type": "json", "property": "features" }
          },
          "mark": { "type": "geoshape", "fill": "#a8ddb5", "stroke": "white" }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/API_level_subarea.csv"
          },
          "transform": [
            { "filter": "datum.State != 'Sabah' && datum.State != 'Sarawak'" },
            {
              "calculate": "datum.API_Level < 30 ? 'Good' : datum.API_Level <= 100 ? 'Moderate' : datum.API_Level <= 140 ? 'Unhealthy' : datum.API_Level <= 160 ? 'Very Unhealthy' : 'Hazardous'",
              "as": "API_Category"
            }
          ],
          "mark": {
            "type": "circle",
            "opacity": 0.8,
            "stroke": "black",
            "strokeWidth": 0.5
          },
          "encoding": {
            "longitude": { "field": "Longitude", "type": "quantitative" },
            "latitude": { "field": "Latitude", "type": "quantitative" },
            "size": {
              "field": "API_Level",
              "type": "quantitative",
              "title": "API Level",
              "legend": null
            },
            "color": {
              "field": "API_Category",
              "type": "nominal",
              "title": "Air Quality Category",
              "scale": {
                "domain": [
                  "Good",
                  "Moderate",
                  "Unhealthy",
                  "Very Unhealthy",
                  "Hazardous"
                ],
                "range": ["#2ecc71", "#f1c40f", "#e67e22", "#e74c3c", "#7d3c98"]
              },
              "legend": {
                "orient": "none",
                "direction": "vertical",
                "legendX": 500,
                "legendY": 30,
                "fillColor": "#deebf7",
                "labelFontSize": 11,
                "titleFontSize": 12
              }
            },
            "tooltip": [
              { "field": "Subarea", "title": "Subarea" },
              { "field": "State", "title": "State" },
              { "field": "API_Level", "title": "API Level" },
              { "field": "API_Category", "title": "Air Quality" }
            ]
          }
        },
        {
          "data": {
            "values": [
              { "x1": 101.05, "y1": 4.4667, "x2": 100, "y2": 4.1 },
              { "x1": 103.3333, "y1": 3.8167, "x2": 103.5, "y2": 3.4 }
            ]
          },
          "mark": { "type": "rule", "strokeWidth": 1, "color": "#333" },
          "encoding": {
            "longitude": { "field": "x1" },
            "latitude": { "field": "y1" },
            "longitude2": { "field": "x2" },
            "latitude2": { "field": "y2" }
          }
        },
        {
          "data": {
            "values": [
              {
                "Longitude": 99,
                "Latitude": 4,
                "label": "ðŸ“ˆ Highest API Level in Perak: Batu Gajah",
                "align": "right"
              },
              {
                "Longitude": 105,
                "Latitude": 3.4,
                "label": "ðŸ’¨ Kuantan's API rises during haze periods",
                "align": "left"
              }
            ]
          },
          "mark": {
            "type": "text",
            "baseline": "middle",
            "fontSize": 11,
            "fontWeight": "bold",
            "fontStyle": "italic",
            "color": "black"
          },
          "encoding": {
            "longitude": { "field": "Longitude" },
            "latitude": { "field": "Latitude" },
            "text": { "field": "label" }
          }
        }
      ],
      "config": { "background": "#deebf7" }
    };

    // ====== Chart 3: Sabah & Sarawak Map ======
    const Sabah_Sarawak = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "API Levels (Sabah & Sarawak)",
      "width": 650,
      "height": 400,
      "projection": {
        "type": "mercator",
        "center": [114, 5],
        "scale": 2600,
        "translate": [350, 200]
      },
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/nullifye/malaysia.geojson/refs/heads/master/malaysia.state.geojson",
            "format": { "type": "json", "property": "features" }
          },
          "mark": { "type": "geoshape", "fill": "#a8ddb5", "stroke": "white" }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/API_level_subarea.csv"
          },
          "transform": [
            { "filter": "datum.State == 'Sabah' || datum.State == 'Sarawak'" },
            {
              "calculate": "datum.API_Level < 30 ? 'Good' : datum.API_Level <= 100 ? 'Moderate' : datum.API_Level <= 140 ? 'Unhealthy' : datum.API_Level <= 160 ? 'Very Unhealthy' : 'Hazardous'",
              "as": "API_Category"
            }
          ],
          "mark": {
            "type": "circle",
            "opacity": 0.8,
            "stroke": "black",
            "strokeWidth": 0.5
          },
          "encoding": {
            "longitude": { "field": "Longitude", "type": "quantitative" },
            "latitude": { "field": "Latitude", "type": "quantitative" },
            "size": {
              "field": "API_Level",
              "type": "quantitative",
              "title": "API Level",
              "legend": null
            },
            "color": {
              "field": "API_Category",
              "type": "nominal",
              "title": "Air Quality Category",
              "scale": {
                "domain": [
                  "Good",
                  "Moderate",
                  "Unhealthy",
                  "Very Unhealthy",
                  "Hazardous"
                ],
                "range": ["#2ecc71", "#f1c40f", "#e67e22", "#e74c3c", "#7d3c98"]
              },
              "legend": {
                "orient": "none",
                "direction": "vertical",
                "legendX": 50,
                "legendY": 30,
                "fillColor": "#deebf7",
                "labelFontSize": 11,
                "titleFontSize": 12
              }
            },
            "tooltip": [
              { "field": "Subarea", "title": "Subarea" },
              { "field": "State", "title": "State" },
              { "field": "API_Level", "title": "API Level" },
              { "field": "API_Category", "title": "Air Quality" }
            ]
          }
        },
        {
          "data": {
            "values": [
              { "x1": 111.8308, "y1": 2.2878, "x2": 111, "y2": 5.1 },
              { "x1": 116.1667, "y1": 5.3333, "x2": 117, "y2": 2.8 }
            ]
          },
          "mark": { "type": "rule", "strokeWidth": 1, "color": "#333" },
          "encoding": {
            "longitude": { "field": "x1" },
            "latitude": { "field": "y1" },
            "longitude2": { "field": "x2" },
            "latitude2": { "field": "y2" }
          }
        },
        {
          "data": {
            "values": [
              {
                "Longitude": 110.8308,
                "Latitude": 5.3,
                "label": "ðŸªµ Sibu has very unhealthy API levels due to dense urban emissions.",
                "align": "right"
              },
              {
                "Longitude": 117.3,
                "Latitude": 2.5,
                "label": "ðŸ’¨ Moderate API due to low traffic.",
                "align": "left"
              }
            ]
          },
          "mark": {
            "type": "text",
            "baseline": "middle",
            "fontSize": 11,
            "fontWeight": "bold",
            "fontStyle": "italic",
            "color": "black"
          },
          "encoding": {
            "longitude": { "field": "Longitude" },
            "latitude": { "field": "Latitude" },
            "text": { "field": "label" }
          }
        }
      ],
      "config": { "background": "#deebf7" }
    }
      ;

    // ====== Chart 4: Pollutant Comparison ======
    const lollipopChart = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "API Levels of each Air Pollutant",
      "width": 800,
      "height": 450,
      "data": {
        "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/API_level_pollutant.csv"
      },
      "params": [
        {
          "name": "Month_selection",
          "value": "2024-01",
          "bind": {
            "input": "select",
            "options": [
              "2024-01", "2024-02", "2024-03", "2024-04", "2024-05", "2024-06",
              "2024-07", "2024-08", "2024-09", "2024-10", "2024-11", "2024-12"
            ],
            "labels": [
              "January", "February", "March", "April", "May", "June",
              "July", "August", "September", "October", "November", "December"
            ],
            "name": "Select Month: "
          }
        },
        {
          "name": "State_selection",
          "value": "Johor",
          "bind": {
            "input": "select",
            "options": [
              "Johor", "Kedah", "Kelantan", "Melaka", "Negeri Sembilan",
              "Pahang", "Perak", "Perlis", "Penang", "Selangor", "Terengganu",
              "Sabah", "Sarawak"
            ],
            "name": "Select State: "
          }
        }
      ],
      "transform": [
        { "filter": "datum.Month == Month_selection && datum.State == State_selection" },
        {
          "calculate": "toNumber(datum['API Level'])",
          "as": "API_Level_num"
        },
        {
          "joinaggregate": [
            {
              "op": "max",
              "field": "API_Level_num",
              "as": "max_API"
            }
          ]
        },
        {
          "calculate": "datum.API_Level_num == datum.max_API ? 'Highest' : 'Other'",
          "as": "Category"
        }
      ],
      "layer": [
        {
          "mark": { "type": "rule", "strokeWidth": 2 },
          "encoding": {
            "y": { "field": "Pollutant", "type": "nominal", "title": "Pollutant" },
            "x": { "field": "API_Level_num", "type": "quantitative" },
            "x2": { "value": 0 },
            "color": {
              "field": "Category",
              "type": "nominal",
              "scale": {
                "domain": ["Highest", "Other"],
                "range": ["red", "lightgrey"]
              },
              "legend": null
            }
          }
        },
        {
          "mark": { "type": "circle", "size": 120 },
          "encoding": {
            "y": { "field": "Pollutant", "type": "nominal" },
            "x": { "field": "API_Level_num", "type": "quantitative", "title": "API Level" },
            "color": {
              "field": "Category",
              "type": "nominal",
              "scale": {
                "domain": ["Highest", "Other"],
                "range": ["red", "lightgray"]
              },
              "legend": null
            },
            "tooltip": [
              { "field": "Pollutant", "type": "nominal" },
              { "field": "API_Level_num", "type": "quantitative", "format": ".2f" }
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 8,
            "fontSize": 10,
            "fontStyle": "italic",
            "color": "black"
          },
          "encoding": {
            "y": { "field": "Pollutant", "type": "nominal" },
            "x": { "field": "API_Level_num", "type": "quantitative" },
            "text": { "field": "API_Level_num", "type": "quantitative", "format": ".2f" }
          }
        }
      ],
      "config": {
        "view": { "stroke": "transparent" },
        "padding": { "right": 40 },
        "axis": { "grid": false }
      }


    }
      ;

    // ====== Chart 5: Monthly API Line Chart (Interactive) ======
    const lineChart = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "Monthly Air Pollution Index by State (2024)",
      "width": 800,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/Malaysia_Monthly_AirQuality_2024.csv"
      },
      "params": [
        {
          "name": "StateSelection",
          "value": "Johor",
          "bind": {
            "input": "select",
            "options": [
              "Johor",
              "Kedah",
              "Kelantan",
              "Melaka",
              "Negeri Sembilan",
              "Pahang",
              "Perak",
              "Perlis",
              "Penang",
              "Sabah",
              "Sarawak",
              "Selangor",
              "Terengganu"
            ],
            "name": "Select State: "
          }
        }
      ],
      "transform": [
        { "calculate": "toNumber(datum.API_Value)", "as": "API_Value_num" },
        { "filter": "datum.State == StateSelection" }
      ],
      "layer": [
        {
          "mark": { "type": "line", "point": true },
          "encoding": {
            "x": {
              "field": "Month",
              "type": "ordinal",
              "title": "Month",
              "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
            },
            "y": {
              "field": "API_Value_num",
              "type": "quantitative",
              "title": "Air Pollution Index (API)"
            },
            "color": { "field": "State", "type": "nominal", "legend": null },
            "tooltip": [
              { "field": "State" },
              { "field": "Month" },
              { "field": "API_Value_num" }
            ]
          }
        },
        {
          "mark": {
            "type": "rule",
            "color": "red",
            "strokeDash": [6, 6]
          },
          "encoding": {
            "y": { "datum": 100 }
          }
        },
        {
          "mark": {
            "type": "text",
            "text": "API 100 (Moderate)",
            "align": "left",
            "baseline": "bottom",
            "dx": 200,
            "dy": -5,
            "color": "red"
          },
          "encoding": {
            "y": { "datum": 100 }
          }
        }
      ],
      "config": {
        "axis": { "grid": false },
        "view": { "stroke": "transparent" }
      }
    };

    // ====== Chart 6: Rainfall vs API level ======
    const scatterPlot = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "title": "Impact of Rainfall on API Value Across Malaysian States",
      "width": 800,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/rainfall_monthly.csv"
      },
      "params": [
        {
          "name": "State_selection",
          "value": "Johor",
          "bind": {
            "input": "select",
            "options": [
              "Johor", "Kedah", "Kelantan", "Melaka", "Negeri Sembilan",
              "Pahang", "Perak", "Perlis", "Penang", "Selangor",
              "Terengganu", "Sabah", "Sarawak"
            ],
            "name": "Select State: "
          }
        }
      ],
      "transform": [
        { "filter": "datum.State == State_selection" },
        { "calculate": "toNumber(datum.Rainfall)", "as": "Rainfall" },
        { "calculate": "toNumber(datum.API_Value)", "as": "API_Value" }
      ],
      "layer": [
        {
          "mark": {
            "type": "point",
            "color": "purple",
            "filled": true,
            "size": 80
          },
          "encoding": {
            "x": { "field": "Rainfall", "type": "quantitative", "title": "Rainfall (mm)" },
            "y": { "field": "API_Value", "type": "quantitative", "title": "API Level" },
            "tooltip": [
              { "field": "State", "type": "nominal" },
              { "field": "Month", "type": "nominal" },
              { "field": "Rainfall", "type": "quantitative" },
              { "field": "API_Value", "type": "quantitative" }
            ]
          }
        },
        {

          "transform": [
            { "aggregate": [{ "op": "mean", "field": "Rainfall", "as": "avg_rainfall" }] }
          ],
          "layer": [
            {
              "mark": { "type": "rule", "color": "red", "strokeDash": [6, 6], "strokeWidth": 2 },
              "encoding": {
                "x": { "field": "avg_rainfall", "type": "quantitative" }
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "left",
                "baseline": "bottom",
                "dx": 5,
                "dy": -5,
                "color": "red",
                "fontSize": 17,
                "fontStyle": "italic"
              },
              "encoding": {
                "x": { "field": "avg_rainfall", "type": "quantitative" },
                "y": { "datum": 0 },
                "text": {
                  "field": "avg_rainfall",
                  "type": "quantitative",
                  "format": ".2f"
                }
              }
            }
          ]
        }
      ],
      "config": { "axis": { "grid": false } },
      "view": { "stroke": "transparent" }
    };

    // ====== Chart 7: Area Type vs API level ======
    const stackedBar = {
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "description": "Stacked bar chart comparing API levels of pollutants in Urban and Rural areas.",
      "title": "Air Pollutant Levels Between Urban and Rural Areas",
      "width": 700,
      "height": 500,
      "data": {
        "url": "https://raw.githubusercontent.com/zhitying/FIT3179-Homework-data/refs/heads/main/urban_rural_API_level.csv"
      },
      "mark": { "type": "bar" },
      "encoding": {
        "x": {
          "field": "Area Type",
          "type": "nominal",
          "axis": { "title": "Area Type" },
          "scale": { "paddingInner": 0.5 }
        },
        "y": {
          "field": "API Value",
          "type": "quantitative",
          "stack": "normalize",
          "axis": { "title": "Proportion of Total API Level" }
        },
        "color": {
          "field": "Pollutant",
          "type": "nominal",
          "title": "Pollutant",
          "scale": {
            "range": [
              "#0072B2",  // blue
              "#E69F00",  // orange
              "#F0E442",  // yellow
              "#56B4E9",  // sky blue
              "#D55E00",  // vermillion
              "#CC79A7"   // reddish purple
            ]
          }
        },
        "tooltip": [
          { "field": "Area Type", "type": "nominal" },
          { "field": "Pollutant", "type": "nominal" },
          { "field": "API Value", "type": "quantitative" }
        ]
      },
      "config": {
        "axis": { "grid": false },
        "view": { "stroke": "transparent" }
      }
    }



    // ====== Embed charts ======
    vegaEmbed('#MalaysiaMap', MalaysiaMap, { actions: false });
    vegaEmbed('#PeninsularMap', PeninsularMap, { actions: false });
    vegaEmbed('#Sabah_Sarawak', Sabah_Sarawak, { actions: false });
    vegaEmbed('#lollipopChart', lollipopChart, { actions: false });
    vegaEmbed('#lineChart', lineChart, { actions: false });
    vegaEmbed('#scatterPlot', scatterPlot, { actions: false });
    vegaEmbed('#stackedBar', stackedBar, { actions: false });
  </script>
</body>

</html>